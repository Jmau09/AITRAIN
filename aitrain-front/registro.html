<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Registro - AiTrain</title>
    <style>
        *{ box-sizing:border-box;
            margin:0;
            padding:0;
            font-family:Inter,Segoe UI,Arial,Helvetica,sans-serif
        }
        body {
            background:#f4f6f8;
            display:flex;
            align-items:center;
            justify-content:center;
            min-height:100vh;
            padding:20px
        }
        .card {
            background:#fff;
            border-radius:12px;
            box-shadow:0 8px 30px rgba(2,6,23,0.08);
            width:100%;
            max-width:920px;
            display:flex;overflow:hidden
        }
        .left {
            flex:1;
            padding:40px;
            background:#000000;
            color:#fff;
            display:flex;
            flex-direction:column;
            justify-content:center;
            gap:16px
        }
        .left .logo {
            display:flex;
            gap:12px;
            align-items:center
        }
        .left .logo img {
            width:64px;
            height:auto
        }
        .left h1 {
            font-size:28px;
            margin-top:6px
        }
        .left p {
            color:rgba(255,255,255,0.85);
            max-width:320px;
            line-height:1.5
        }
        .left ul {
            list-style:none;
            margin-top:8px;
            padding-left:0;
            color:rgba(255,255,255,0.85)
        }
        .left ul li {
            margin-bottom:6px
        }
        .right {
            flex:1;padding:32px 40px;
            display:flex;
            flex-direction:column;
            justify-content:center;
            gap:16px
        }
        h2 {
            font-size:22px;
            color:#0f1724;
            margin-bottom:4px
        }
        p.sub {
            color:#6b7280;
            margin-bottom:24px;
            line-height:1.5
        }
        form {
            display:grid;
            grid-template-columns:repeat(2,1fr);
            gap:12px
        }
        .full {
            grid-column:1/3
        }
        label {
            font-size:13px;
            color:#374151;
            margin-bottom:6px;
            display:block
        }
        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="number"]
        {
            width:100%;
            padding:10px 12px;
            border-radius:8px;
            border:1px solid #e6e9ee;background:#fff;
            outline:none;
            font-size:14px;
        }
        input:focus {
            border-color:#ef4444;
            box-shadow:0 0 0 3px rgba(239,68,68,0.07)
        }
        .actions {
            grid-column:1/3;
            display:flex;
            flex-direction:column;
            gap:8px;margin-top:6px
        }
        button {
            background:#ef4444;
            color:#fff;
            border:none;
            padding:12px;
            border-radius:8px;
            font-weight:600;
            cursor:pointer;
            transition:0.2s
        }
        button:hover {
            background:#dc2626
        }
        button.secondary {
            background:#eef2f7;
            color:#0f1724
        }
        #mensaje {
            grid-column:1/3;
            text-align:center;
            padding:10px;
            border-radius:8px;
            display:none
        }
        @media (max-width:780px) {
            form{grid-template-columns:1fr}.left{display:none}
        }
    </style>
</head>
<body>
<div class="card" role="main">
    <div class="left" aria-hidden="true">
        <div class="logo">
            <img src="brazo.png" alt="AiTrain logo (local)" />
            <div style="font-weight:700;font-size:18px">Ai<span style="color:#f43f5e">Train</span></div>
        </div>
        <h1>Únete a la revolución del fitness con IA</h1>
        <p>Crea tu cuenta y comienza tu transformación física con rutinas personalizadas y seguimiento inteligente.</p>
        <ul>
            <li>✓ Rutinas personalizadas con IA</li>
            <li>✓ Seguimiento detallado de progreso</li>
            <li>✓ Ajustes dinámicos según tu rendimiento</li>
            <li>✓ Recomendaciones nutricionales</li>
        </ul>
    </div>

    <div class="right">
        <div>
            <h2>Crear cuenta</h2>
            <p class="sub">Rellena los datos para registrarte en AiTrain.</p>
        </div>

        <form id="registerForm" novalidate>
            <div>
                <label for="cedula">Cédula</label>
                <input id="cedula" type="text" placeholder="1000000000" required />
            </div>

            <div>
                <label for="nombre">Nombre</label>
                <input id="nombre" type="text" placeholder="Camila" required />
            </div>

            <div>
                <label for="apellido">Apellido</label>
                <input id="apellido" type="text" placeholder="Torres" required />
            </div>

            <div>
                <label for="telefono">Teléfono</label>
                <input id="telefono" type="text" placeholder="3107924077" required />
            </div>

            <div class="full">
                <label for="email">Email</label>
                <input id="email" type="email" placeholder="usuario@ejemplo.com" required />
            </div>

            <div>
                <label for="password">Contraseña</label>
                <input id="password" type="password" placeholder="••••••••" required minlength="4" />
            </div>

            <div>
                <label for="edad">Edad</label>
                <input id="edad" type="number" min="1" max="120" placeholder="20" required />
            </div>

            <div class="actions full">
                <button type="submit">Crear cuenta</button>
                <button type="button" class="secondary" id="limpiarBtn">Limpiar</button>
            </div>

            <div class="login-link full">
                ¿Ya tienes cuenta? <a href="login.html">Inicia sesión</a>
            </div>

            <div id="mensaje" class="full" role="status"></div>
        </form>
    </div>
</div>

<script>
    const API_SAVE = 'http://localhost:8080/api/aitrain/usuario/save';
    const form = document.getElementById('registerForm');
    const mensajeDiv = document.getElementById('mensaje');
    const limpiarBtn = document.getElementById('limpiarBtn');

    function mostrarMensaje(text, tipo = 'info') {
        mensajeDiv.style.display = 'block';
        mensajeDiv.textContent = text;
        if (tipo === 'ok') {
            mensajeDiv.style.background = '#ecfdf5';
            mensajeDiv.style.color = '#065f46';
            mensajeDiv.style.border = '1px solid #bbf7d0';
        } else if (tipo === 'error') {
            mensajeDiv.style.background = '#fff1f2';
            mensajeDiv.style.color = '#7f1d1d';
            mensajeDiv.style.border = '1px solid #fecaca';
        } else {
            mensajeDiv.style.background = '#eef2ff';
            mensajeDiv.style.color = '#1e293b';
            mensajeDiv.style.border = '1px solid #c7d2fe';
        }
    }

    limpiarBtn.addEventListener('click', () => {
        form.reset();
        mensajeDiv.style.display = 'none';
    });

    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        mensajeDiv.style.display = 'none';

        const payload = {
            cedula: document.getElementById('cedula').value.trim(),
            nombre: document.getElementById('nombre').value.trim(),
            apellido: document.getElementById('apellido').value.trim(),
            email: document.getElementById('email').value.trim(),
            telefono: document.getElementById('telefono').value.trim(),
            password: document.getElementById('password').value,
            edad: Number(document.getElementById('edad').value)
        };

        try {
            mostrarMensaje('Enviando registro...', 'info');
            const res = await fetch(API_SAVE, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            let data;
            const text = await res.text();

            try {
                data = JSON.parse(text);
            } catch {
                data = text;
            }

            if (res.ok) {
                // ✅ Registro exitoso → redirige a la página de éxito
                window.location.href = 'registro_exitoso.html';
            } else {
                if (data && data.message) {
                    mostrarMensaje('❌ ' + data.message, 'error');
                } else if (typeof data === 'string') {
                    mostrarMensaje('❌ ' + data, 'error');
                } else {
                    mostrarMensaje('❌ Error desconocido al registrar el usuario', 'error');
                }
            }
        } catch (err) {
            console.error(err);
            mostrarMensaje('⚠️ No se pudo conectar al servidor', 'error');
        }
    });
</script>
</body>
</html>
